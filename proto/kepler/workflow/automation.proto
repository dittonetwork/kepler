syntax = "proto3";
package kepler.workflow;

option go_package = "kepler/x/workflow/types";

// Automation entity
message Automation {
  uint64 id = 1; // Incremental ID for blockchain consistency
  Trigger trigger = 2; // List of trigger conditions
  repeated Action actions = 3; // List of actions
  uint64 repeat_count = 4; // Number of executions allowed
  uint64 repeat_interval = 5; // Interval between repeated executions allowed
  uint64 expire_at = 6; // Expiration timestamp (Unix time)
  AutomationStatus status = 7; // Status of the automation (active, expired, paused, failed, done)
}

// Enumeration for automation status
enum AutomationStatus {
  AUTOMATION_STATUS_STATUS_UNSPECIFIED = 0; // Default unknown status
  AUTOMATION_STATUS_ACTIVE = 1; // Active automation
  AUTOMATION_STATUS_EXPIRED = 2; // Expired automation
  AUTOMATION_STATUS_PAUSED = 3; // Paused automation
  AUTOMATION_STATUS_FAILED = 4; // Failed automation
  AUTOMATION_STATUS_DONE = 5; // Completed automation
}

// Base trigger with type selection
message Trigger {
  oneof trigger {
    PriceTrigger price = 1;
    TimeTrigger time = 2;
    LogicalTrigger logical = 3;
  }
}

// Asset price trigger
message PriceTrigger {
  string asset = 1;
  string operator = 2; // ">", "<", "=="
  string target_price = 3;
}

// Time trigger
message TimeTrigger {
  uint64 timestamp = 1;
}

// Logical trigger for trigger chains
message LogicalTrigger {
  LogicalOperator logical_operator = 1; // "AND", "OR"
  repeated Trigger triggers = 2;
}

// Enumeration for logical operator
enum LogicalOperator {
  LOGICAL_OPERATOR_UNSPECIFIED = 0; // Default unknown operator
  LOGICAL_OPERATOR_AND = 1; // Logical AND operator
  LOGICAL_OPERATOR_OR = 2; // Logical OR operator
  LOGICAL_OPERATOR_NOT = 3; // Logical OR operator
}

message Action {
  oneof action {
    ExecuteContract execute_contract = 1;
    Trade trade = 2;
  }
}

// Execute contract action
message ExecuteContract {
  string contract_id = 1;
  string function = 2;
}

// Trade action
message Trade {
  string asset = 1;
  string amount = 2;
  string price = 3;
  string side = 4; // "buy", "sell"
}